{"version":3,"file":"grid-helper.mjs","sources":["../index.ts"],"sourcesContent":["import { GridHelperBreakpointConfig, GridHelperConfig, SharedGridConfig } from './types';\n\n// Default configuration\nconst defaultConfig: GridHelperConfig = {\n    columns: 12,\n    gutterWidth: '16px',\n    marginWidth: '16px',\n    color: 'red',\n    opacity: 0.1,\n    key: 'g'\n};\n\n/**\n * Grid Helper\n *\n * Provides a grid based on the design guidelines and is helpful for web integration.\n *\n * - `Control + g` to toggle the grid\n *\n */\nexport default class GridHelper {\n    private sharedConfig: SharedGridConfig;\n    private breakpoints: { [key: string]: Partial<GridHelperBreakpointConfig> };\n    private currentBreakpointConfig: GridHelperBreakpointConfig;\n    private previousBreakpointConfig: GridHelperBreakpointConfig | null = null;\n    private gridContainer: HTMLElement;\n    private isActive: boolean = false;\n    private ctrlDown: boolean = false;\n\n    constructor(config: Partial<GridHelperConfig> = {}) {\n        const mergedConfig = this.mergeConfig(config, defaultConfig);\n        this.sharedConfig = mergedConfig;\n        this.breakpoints = mergedConfig.breakpoints || {};\n\n        // Determine initial breakpoint config\n        this.currentBreakpointConfig = this.getBreakpointConfig();\n        this.previousBreakpointConfig = this.currentBreakpointConfig;\n\n        // Initialize the grid container\n        this.gridContainer = document.createElement('div');\n        document.body.append(this.gridContainer);\n\n        this.initialize();\n    }\n\n    /**\n     * Deep merge user config with default config\n     */\n    private mergeConfig(\n        userConfig: Partial<GridHelperConfig>,\n        defaultConfig: GridHelperConfig\n    ): GridHelperConfig {\n        const breakpoints = { ...defaultConfig.breakpoints, ...userConfig.breakpoints };\n\n        if (userConfig.breakpoints) {\n            for (const key in userConfig.breakpoints) {\n                breakpoints[key] = { ...breakpoints[key], ...userConfig.breakpoints[key] };\n            }\n        }\n\n        delete userConfig.breakpoints;\n\n        const sharedConfig = { ...defaultConfig, ...userConfig };\n\n        return {\n            ...sharedConfig,\n            breakpoints\n        };\n    }\n\n    /**\n     * Initialize the grid helper by setting styles, columns, and events.\n     */\n    private initialize() {\n        this.setGridEvents();\n    }\n\n    /**\n     * Get the current breakpoint configuration based on the window width.\n     */\n    private getBreakpointConfig(): GridHelperBreakpointConfig {\n        const width = window.innerWidth;\n        let matchedBreakpointConfig: Partial<GridHelperBreakpointConfig> = this.sharedConfig;\n\n        // Find the closest breakpoint that is less than or equal to the current window width.\n        for (const [breakpoint, config] of Object.entries(this.breakpoints)) {\n            if (width >= parseInt(breakpoint)) {\n                matchedBreakpointConfig = { ...this.sharedConfig, ...config };\n            }\n        }\n\n        return matchedBreakpointConfig as GridHelperBreakpointConfig;\n    }\n\n    private extractCSSVariable(value: string): string | null {\n        const match = value.match(/var\\((--[\\w-]+)\\)/);\n        return match ? match[1] : null;\n    }\n\n    /**\n     * Set grid container styles.\n     */\n    private setGridHelperStyles() {\n        const elStyles = this.gridContainer.style;\n        elStyles.zIndex = '10000';\n        elStyles.position = 'fixed';\n        elStyles.top = '0';\n        elStyles.left = '0';\n        elStyles.display = 'flex';\n        elStyles.width = '100%';\n        elStyles.height = '100%';\n        elStyles.columnGap = `${this.currentBreakpointConfig.gutterWidth}`;\n        elStyles.paddingLeft = `${this.currentBreakpointConfig.marginWidth}`;\n        elStyles.paddingRight = `${this.currentBreakpointConfig.marginWidth}`;\n        elStyles.pointerEvents = 'none';\n        elStyles.visibility = this.isActive ? 'visible' : 'hidden';\n    }\n\n    /**\n     * Set grid columns.\n     */\n    private setGridHelperColumns() {\n        // Clear previous columns\n        this.gridContainer.innerHTML = '';\n\n        let columns = 0;\n\n        // Get the columns value, which can be either a number or a string\n        let configColumns = this.currentBreakpointConfig.columns;\n\n        // If configColumns is a string, check if it's a CSS variable\n        if (typeof configColumns === 'string') {\n            const cssVariable = this.extractCSSVariable(configColumns);\n\n            if (cssVariable) {\n                const computedStyle = getComputedStyle(document.documentElement);\n                const cssValue = computedStyle.getPropertyValue(cssVariable);\n\n                // Parse the CSS variable value to an integer\n                columns = parseInt(cssValue);\n\n                // Provide a fallback in case of NaN\n                if (isNaN(columns)) {\n                    columns = 12; // Default fallback\n                }\n            }\n        } else if (typeof configColumns === 'number') {\n            columns = configColumns;\n        }\n\n        for (let i = 0; i < columns; i++) {\n            const column = document.createElement('div');\n            column.style.flex = '1 1 0';\n            column.style.backgroundColor = this.currentBreakpointConfig.color;\n            column.style.opacity = `${this.currentBreakpointConfig.opacity}`;\n            this.gridContainer.appendChild(column);\n        }\n    }\n\n    /**\n     * Set grid events for resize and keydown.\n     */\n    private setGridEvents() {\n        // Handle resize to update the grid columns and styles\n        window.addEventListener('resize', () => {\n            this.currentBreakpointConfig = this.getBreakpointConfig();\n\n            this.setGridHelperStyles();\n            this.setGridHelperColumns();\n        });\n\n        // Toggle grid visibility with keyboard events\n        document.addEventListener('keydown', (e) => this.handleKeyDown(e));\n        document.addEventListener('keyup', (e) => this.handleKeyUp(e));\n    }\n\n    /**\n     * Handle keydown event to toggle the grid.\n     */\n    private handleKeyDown(e: KeyboardEvent) {\n        if (e.key === 'Control') {\n            this.ctrlDown = true;\n        } else if (this.ctrlDown && e.key === this.sharedConfig.key) {\n            this.currentBreakpointConfig = this.getBreakpointConfig();\n\n            this.setGridHelperStyles();\n            this.setGridHelperColumns();\n\n            this.toggleGridVisibility();\n        }\n    }\n\n    /**\n     * Handle keyup event to reset Control key state.\n     */\n    private handleKeyUp(e: KeyboardEvent) {\n        if (e.key === 'Control') {\n            this.ctrlDown = false;\n        }\n    }\n\n    /**\n     * Toggle the visibility of the grid.\n     */\n    private toggleGridVisibility() {\n        this.gridContainer.style.visibility = this.isActive ? 'hidden' : 'visible';\n        this.isActive = !this.isActive;\n    }\n}\n\nexport * from './types';\n"],"names":["defaultConfig","columns","gutterWidth","marginWidth","color","opacity","key","GridHelper","config","sharedConfig","breakpoints","this","currentBreakpointConfig","previousBreakpointConfig","gridContainer","isActive","ctrlDown","mergedConfig","mergeConfig","getBreakpointConfig","document","createElement","body","append","initialize","_proto","prototype","userConfig","_extends","setGridEvents","width","window","innerWidth","matchedBreakpointConfig","_i","_Object$entries","Object","entries","length","_Object$entries$_i","parseInt","extractCSSVariable","value","match","setGridHelperStyles","elStyles","style","zIndex","position","top","left","display","height","columnGap","paddingLeft","paddingRight","pointerEvents","visibility","setGridHelperColumns","innerHTML","configColumns","cssVariable","cssValue","getComputedStyle","documentElement","getPropertyValue","isNaN","i","column","flex","backgroundColor","appendChild","_this","addEventListener","e","handleKeyDown","handleKeyUp","toggleGridVisibility"],"mappings":"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"}